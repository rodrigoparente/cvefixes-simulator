# python imports
import pandas as pd

# local imports
from .constants import FIX_VULNERABILITY


def prioritize_vulnerability(env):

    df = pd.DataFrame.from_records(env['vulnerabilities'])

    df['risk_score'] = pd.Categorical(
        df.risk_score, categories=['LOW', 'MODERATE', 'IMPORTANT', 'CRITICAL'], ordered=True)

    cvss_sorted = df.sort_values(by=['base_score'], ascending=False)
    cvss_sorted = cvss_sorted[['cve_id', 'base_score']]

    frape_sorted = df.sort_values(by=['risk_score', 'risk_proba'], ascending=[False, False])
    frape_sorted = frape_sorted[['cve_id', 'risk_score', 'risk_proba']]

    env = {
        **env,
        'cvss_order': cvss_sorted['cve_id'].tolist(),
        'frape_order': frape_sorted['cve_id'].tolist()
    }

    return (FIX_VULNERABILITY, env)
